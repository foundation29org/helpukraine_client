<section id="">
	<div class="row">
		<div class="col-sm-12">
			<div class="card">
				<div class="card-content">
					<div class="card-body mt-2">
						<agm-map [latitude]="lat" [longitude]="lng" [zoom]="zoom">
							<!--[label]="m.userName" [iconUrl]="m.iconUrl"-->
							<agm-marker *ngFor="let m of users; let i = index" [latitude]="m.lat" [longitude]="m.lng">

								<agm-info-window>
									<strong>{{m.userName}}</strong>
									<p class="mb-1 mt-1">{{m.email}}</p>
									<p>{{m.countryPhoneCode}} {{m.phone}}</p>
									<a (click)="viewInfoPatient(m,InfoPatient)" href="javascript:void(0)"><i
											class="btn btn-dark ft-eye"></i></a>
								</agm-info-window>

							</agm-marker>
						</agm-map>
					</div>
				</div>
			</div>
		</div>
	</div>
</section>
<div class="row" *ngIf="!addedlang && !working">
	<div class="col-lg-12 col-12">


		<div class="card">
			<div class="card-header">
				<h4 class="card-title">{{'war.Users' | translate }}
					<div class="float-right">
						<button class="mb-0 btn btn-primary btn-sm"
							(click)="onSubmitExportData()">{{'generics.ExportData' | translate }}</button>
						<div class="d-none"><span id="content"></span></div>
					</div>
				</h4>

			</div>
			<div class="center-elements" *ngIf="loadingUsers">
				<div>
					<p class="centerSpinner"><i class="fa fa-spinner fa-spin fa-3x fa-fw pink"></i></p>
				</div>
			</div>
			<div class="card-body table-responsive" *ngIf="!loadingUsers && users.length>0">
				<ngx-datatable class="bootstrap fullscreen" [columnMode]="'flex'" [headerHeight]="50"
					[footerHeight]="50" [rowHeight]="'auto'" [rows]="users">
					<!--[limit]="20"-->
					<ngx-datatable-column name="{{'generics.Details' | translate }}" [flexGrow]="2" [sortable]="false">
						<ng-template let-value="value" ngx-datatable-cell-template let-row="row">
							<span>
								<a (click)="viewInfoPatient(row,InfoPatient)" href="javascript:void(0)"><i
										class="btn btn-dark ft-eye"></i></a>
							</span>
						</ng-template>
					</ngx-datatable-column>
					<ngx-datatable-column name="{{'menu.User Profile' | translate }}" prop="userName" [flexGrow]="3"
						[sortable]="true">
						<ng-template let-value="value" ngx-datatable-cell-template let-row="row">
							<span>
								{{value}}
							</span>
						</ng-template>
					</ngx-datatable-column>
					<ngx-datatable-column name="{{'generics.Email' | translate }}" prop="email" [flexGrow]="5"
						[sortable]="true">
						<ng-template let-value="value" ngx-datatable-cell-template>
							<span>
								{{value}}
							</span>
						</ng-template>
					</ngx-datatable-column>
					<ngx-datatable-column name="{{'generics.Name' | translate }} ({{'menu.Patient' | translate }})"
						prop="patientName" [flexGrow]="3" [sortable]="true">
						<ng-template let-value="value" ngx-datatable-cell-template>
							<span>
								{{value}}
							</span>
						</ng-template>
					</ngx-datatable-column>
					<ngx-datatable-column name="{{'personalinfo.Last Name' | translate }}" prop="surname" [flexGrow]="3"
						[sortable]="true">
						<ng-template let-value="value" ngx-datatable-cell-template>
							<span>
								{{value}}
							</span>
						</ng-template>
					</ngx-datatable-column>
					<ngx-datatable-column name="{{'generics.Status' | translate }}" prop="status" [flexGrow]="3"
						[sortable]="true">
						<ng-template let-value="value" ngx-datatable-cell-template let-row="row">
							<span>
								<select id="status" name="status{{i}}" [(ngModel)]="row.status"
									(change)="fieldStatusChanged(row)">
									<option [ngValue]="null" disabled selected>--{{'generics.Select' | translate }}--
									</option>
									<option value="new">{{'war.status.opt1' | translate }}</option>
									<option value="contacted">{{'war.status.opt2' | translate }}</option>
									<option value="pending">{{'war.status.opt3' | translate }}</option>
									<option value="ontheway">{{'war.status.opt4' | translate }}</option>
									<option value="contactlost">{{'war.status.opt5' | translate }}</option>
									<option value="helped">{{'war.status.opt6' | translate }}</option>
								</select>

							</span>
						</ng-template>
					</ngx-datatable-column>
					<ngx-datatable-column name="Blocked account" prop="blockedaccount" [flexGrow]="3" [sortable]="true">
						<ng-template let-value="value" ngx-datatable-cell-template let-row="row">
							<span>
								<ui-switch id="blockedaccount" (change)="userChangedEvent(row, $event)"
									name="row.blockedaccount{{row._id}}" [(ngModel)]="row.blockedaccount"></ui-switch>
							</span>
						</ng-template>

					</ngx-datatable-column>

				</ngx-datatable>
			</div>
			<div class="card-body table-responsive" *ngIf="!loadingUsers && users.length==0">
				{{'war.No users' | translate }}
			</div>

		</div>
	</div>
</div>
<div class="col-lg-12 col-12 form-group" *ngIf="working">
	<div>
		<p class="centerSpinner"><i class="fa fa-spinner fa-spin fa-3x fa-fw pink"></i></p>
	</div>
	<div>{{'generics.Sending' | translate }}...</div>
</div>

<ng-template #InfoPatient let-c="close" let-d="dismiss">
	<div class="modal-header">
		<h4 class="modal-title">{{'war.Detailed information' | translate }}</h4>
		<button type="button" class="close" aria-label="Close" (click)="closePanel()">
			<span aria-hidden="true">&times;</span>
		</button>
	</div>
	<div class="modal-body">
		<div class="px-3">

			<div class="form-body">
				<div class="row">
					<div class="col-md-6">
						<h4 class="mb-0 text-bold-400">
							{{'menu.User Profile' | translate }}
						</h4>
						<p class="mb-0">
							<strong>{{'personalinfo.First Name' | translate }}:</strong> {{user.userName}}
						</p>
						<p class="mb-0">
							<strong>{{'generics.Email' | translate }}:</strong> {{user.email}}
						</p>
						<p class="mb-0">
							<strong>{{'personalinfo.Phone' | translate }}:</strong> {{user.countryPhoneCode}} {{user.phone}}
						</p>
						<div class="row">
							<div class="col-md-6">
								<p class="mb-0">
									<strong>{{'war.Date of registration' | translate }}:</strong> {{user.signupDate
									| date: 'dd MMM y': '' : translate.currentLang}}
								</p>
							</div>
							<div class="col-md-6">
								<p class="mb-0">
									<strong>{{'war.Last login' | translate }}:</strong> {{user.lastLogin | date: 'dd MMM y': '' : translate.currentLang}}
								</p>
							</div>
						</div>

						<h4 class="mt-3 mb-0 text-bold-400">
							{{'menu.Basic Info' | translate }}
						</h4>
						<div class="row">
							<div class="col-md-6">
								<p class="mb-0">
									<strong>{{'personalinfo.First Name' | translate }}:</strong> {{user.patientName}}
								</p>
							</div>
							<div class="col-md-6">
								<p class="mb-0">
									<strong>{{'personalinfo.Last Name' | translate }}:</strong> {{user.surname}}
								</p>
							</div>
							<div class="col-md-6">
								<p class="mb-0">
									<strong>{{'personalinfo.Gender' | translate }}:</strong><span
										*ngIf="user.gender=='female'" class="ml-1">{{'personalinfo.Female' | translate
										}}</span><span *ngIf="user.gender=='male'" class="ml-1">{{'personalinfo.Male' |
										translate }}</span>
								</p>
							</div>
							<div class="col-md-6">
								<p class="mb-0">
									<strong>{{'personalinfo.Birth Date' | translate }}:</strong> {{user.birthDate | date: 'dd MMM y': '' : translate.currentLang}}
								</p>
							</div>

						</div>
						<h4 class="mt-3 mb-0 text-bold-400">
							{{'generics.Status' | translate }}
						</h4>
						<div class="row">
							<div class="col-md-12">
								<select id="status" name="status{{i}}" class="mt-2" [(ngModel)]="user.status"
								(change)="fieldStatusChanged(user)">
								<option [ngValue]="null" disabled selected>--{{'generics.Select' | translate }}--</option>
								<option value="new">{{'war.status.opt1' | translate }}</option>
								<option value="contacted">{{'war.status.opt2' | translate }}</option>
								<option value="pending">{{'war.status.opt3' | translate }}</option>
								<option value="ontheway">{{'war.status.opt4' | translate }}</option>
								<option value="contactlost">{{'war.status.opt5' | translate }}</option>
								<option value="helped">{{'war.status.opt6' | translate }}</option>
							</select>
							</div>
							
	
	
						</div>
					</div>
					<div class="col-md-6">
						<div class="col-md-12">
							<agm-map [latitude]="lat" [longitude]="lng" [zoom]="zoom">
								<agm-marker [latitude]="user.lat" [longitude]="user.lng"></agm-marker>
							</agm-map>
						</div>
					</div>
					<div class="col-md-6">
						<h4 class="mt-3 text-bold-400">
							{{'war.What needs do they have' | translate }}
						</h4>
						<div class="row">
							<div class="col-md-12">
								<p>{{user.needs}}</p>
							</div>

							<div *ngIf="!callingTextAnalytics && user.drugs.length>0" class="col-md-12">
								<table class="table text-center">
									<thead>
										<tr>
											<th>{{'generics.Name' | translate }}</th>
											<th>{{'medication.Dose' | translate }}</th>
											<th>Links</th>
										</tr>
									</thead>
									<tbody>
										<tr *ngFor="let drug of user.drugs ; let i = index">
											<td>{{drug.name}}</td>
											<td>{{drug.dose}}</td>
											<td>
												<a class="info" data-original-title="" title=""
													href="https://www.whocc.no/atc_ddd_index/?code={{drug.link}}"
													target="_blank">
													www.whocc.no
												</a>
												<a class="info d-block" data-original-title="" title=""
													href="https://www.rxreasoner.com/atccodes/{{drug.link}}"
													target="_blank">
													www.rxreasoner.com
												</a>
											</td>
										</tr>
									</tbody>
								</table>

							</div>
						</div>
					</div>
					<div class="col-md-6">
						<h4 class="mt-3 text-bold-400">
							{{'generics.notes' | translate }}
						</h4>
						<div class="row">
							<div class="col-md-12">
								<textarea maxlength="150" name="notes" [(ngModel)]="user.notes"
									placeholder="{{'seizures.Write down any details' | translate }}"
									class="autoajustable form-control"></textarea>
								<a class="mt-2 btn btn-dark" (click)="saveNotes()" href="javascript:void(0)">{{'war.Save
									notes' | translate }}</a>
							</div>
						</div>
					</div>
				</div>
			</div>
		</div>
	</div>
</ng-template>