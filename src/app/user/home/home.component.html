<div class="mt-4 card card-block mx-auto" *ngIf="!loadedInfoPatient" style="max-width: 30rem !important;">
    <div class="card-body">
        <div class="row">
            <div class="col-lg-12 center-elements">
                <div>
                    <i class="fa fa-spinner fa-spin fa-fw"></i>
                </div>
            </div>
        </div>
    </div>
</div>
<div class="mt-4 card card-block mx-auto" *ngIf="loadedInfoPatient && (basicInfoPatient.group==null || step!='0')"
    style="max-width: 30rem !important;">
    <div class="card-body">
        <div class="row">
            <div class="col-lg-12 ">
                <div *ngIf="!loadedInfoPatient">
                    <i class="fa fa-spinner fa-spin fa-fw"></i>
                </div>
                <div *ngIf="loadedInfoPatient">
                    <div *ngIf="basicInfoPatient.group==null || step!='0'"
                        class="justify-content-center align-items-center text-center">
                        <div *ngIf="step=='0'">
                            <h2 class="content-header">{{'generics.Welcome to ucr' | translate }}</h2>
                            <div class="center-elements">
                                <button class="mt-2 btn btn-primary" (click)="question1();">{{'registration.Get Started' |
                                    translate }}</button>
                            </div>
                        </div>
                        <div *ngIf="step=='1'">
                            <h2 class="content-header">{{'homeraito.t2' | translate }}</h2>
                            <select id="group" name="group" class="form-control" ngModel
                                [(ngModel)]="basicInfoPatient.group">
                                <option [value]="null" disabled selected>--{{'generics.Please select' | translate }}--</option>
                                <option *ngFor="let group of groups" [ngValue]="group._id">
                                    <span
                                        *ngIf="group.name != 'Undiagnosed'  && group.name != 'None'">{{group.name}}</span>
                                    <span *ngIf="group.name == 'Undiagnosed'">{{'personalinfo.I dont have a
                                        diagnosis' | translate }}</span>
                                    <span *ngIf="group.name == 'None'">{{'personalinfo.I dont belong to a patient group' | translate }}</span>
                                </option>
                            </select>
                            <div class="center-elements">
                                <button class="mt-3 btn btn-primary" [disabled]="basicInfoPatient.group==null"
                                    (click)="question2();">{{'generics.Next' | translate }}</button>
                            </div>
                        </div>
                        <div *ngIf="step=='2'">
                            <p class="text-muted font-small-2">
                                {{'homeraito.p1' | translate }}
                            </p>
                            <p class="text-muted font-small-2">
                                {{'homeraito.p1.1' | translate }}
                            </p>
                            <h2 class="content-header">{{'homeraito.t3' | translate }}</h2>                            
                            <div class="center-elements mt-1">
                                <!--<button class="mr-1 btn btn-primary" style="width: 100px;" (click)="question3(false);">{{'generics.No' |
                                    translate }}</button>-->
                                <button class="btn btn-primary" style="width: 100px;" (click)="question3(true);">{{'generics.Yes' |
                                    translate }}</button>
                            </div>
                            <div class="center-elements">
                                <button class="mt-3 mb-0 btn btn-dark"
                                    (click)="step='1'">{{'generics.Previous' | translate }}</button>
                            </div>
                        </div>
                        <div *ngIf="step=='3'">
                            <div>
                                <h2 class="content-header mt-0 mb-2">{{'generics.Basic Data' |
                                    translate }}</h2>
                                <form (ngSubmit)="onSubmit()" #f="ngForm">
                                    <p class="text-left">
                                        <ui-switch id="enabled" (change)="changedCaretaker($event)" name="caretaker" [(ngModel)]="userInfo.iscaregiver"></ui-switch> 
                                        <span class="ml-1">{{'war.titletoogle' | translate }}</span>
                                    </p>
                                    <div class="text-left form-group">
                                        <div class="">
                                            <label>{{'menu.Basic Info' | translate }}</label>
                                            <input class="form-control d-none" id="birthDate_" name="birthDate" matInput
                                                placeholder="{{'personalinfo.Birth Date' | translate }}" readonly
                                                [matDatepicker]="pickerOnset" (click)="pickerOnset.open()"
                                                [(ngModel)]="basicInfoPatient.birthDate">
                                            <input readonly class="form-control d-inline" (click)="pickerOnset.open()"
                                                style="background-color: #fff !important;"
                                                [placeholder]="(basicInfoPatient.birthDate!=null) ? (basicInfoPatient.birthDate | date: 'dd MMM y': '' : translate.currentLang) : getLiteral('personalinfo.Birth Date')">
        
                                            <mat-datepicker-toggle matSuffix [for]="pickerOnset" class="d-none">
                                            </mat-datepicker-toggle>
                                            <mat-datepicker startView="multi-year"
                                                (daySelected)="closeDatePickerStart($event, pickerOnset)" touchUi="true"
                                                #pickerOnset></mat-datepicker>
                                            <!--<p *ngIf="datainfo.birthDate ==null || datainfo.birthDate ==''" class="danger">{{'generics.required' | translate }}</p>-->
                                        </div>
                                    </div>
                                    <div class="row mb-3">
                                        <p class="mb-0"><strong>{{'war.Indicates the approximate location' | translate }}</strong></p>
                                        <agm-map [latitude]="lat" [longitude]="lng" [zoom]="zoom"  (mapClick)="changePickupMarkerLocation($event)">
                                            <agm-marker *ngIf="showMarker" [latitude]="basicInfoPatient.lat" [longitude]="basicInfoPatient.lng" [title]="'Pickup Location'"></agm-marker>
                                        </agm-map>
                                    </div>
                                    <div class="form-group text-center mb-0">
                                        <span *ngIf="!sending">
                                            <button class="btn btn-dark mr-1"
                                          (click)="step='2'">{{'generics.Previous' | translate }}</button>
                                            <div *ngIf="f.valid;then formValid else formError"></div>
                                            <ng-template #formValid><button class="ml-1 btn btn-dark" type="submit">
                                                    {{'wizard.btn' | translate }}</button></ng-template>
                                            <ng-template #formError><button class="ml-1 btn btn-dark" type="button"
                                                    (click)="submitInvalidForm()"> {{'wizard.btn' | translate
                                                    }}</button></ng-template>
                                        </span>
                                        <span *ngIf="sending">
                                            <i class="fa fa-spinner fa-spin fa-3x fa-fw"></i>
                                        </span>
                                    </div>
                                </form>
                            </div>
                            <!--<div class="center-elements">
                                
                                <button class="btn btn-primary ml-1" (click)="goStep('0')">{{'wizard.btn' | translate
                                    }}</button>
                            </div>-->
                        </div>
                        <div *ngIf="step=='4'">
                            <p>{{'homeraito.t1.1' | translate }}</p>
                            <div class="center-elements">
                                <button class="btn btn-dark mr-1"
                                    (click)="step='0'">{{'generics.Previous' | translate }}</button>
                                <button class="btn btn-primary ml-1" (click)="goStep('0');setPatientGroup('None');">{{'wizard.btn' | translate
                                    }}</button>
                            </div>
                        </div>
                        <div *ngIf="step=='5'">
                            <h2 class="content-header">{{'war.needsTitle' | translate }}</h2>
                            <p>{{'war.needsSubtitle' | translate }}</p>
                            <textarea maxlength="150" name="needs"  [(ngModel)]="basicInfoPatient.needs"
										placeholder="{{'seizures.Write down any details' | translate }}"
										class="autoajustable form-control"></textarea>
                            
                            <div class="text-left form-group">
                                <mat-checkbox class="example-margin" style="position: absolute; margin-top: 2px;" name="terms2"
                                    id="terms2" [(ngModel)]="basicInfoPatient.needShelter">
                                </mat-checkbox> 
                                <span class="ml-3">
                                    {{'war.Need shelter' | translate }}
                                    </span>
                            </div>
                            <div class="center-elements mt-2">
                                <button class="btn btn-dark mr-1"
                                    (click)="step='3'">{{'generics.Previous' | translate }}</button>
                                <button class="btn btn-primary ml-1" (click)="goStep('0');setNeeds();">{{'generics.Finish' | translate
                                    }}</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<div class="" *ngIf="loadedInfoPatient && basicInfoPatient.group!=null && step=='0'">
    <div class="mx-auto" style="max-width: 30rem !important;">
        <div class="card">
            <div class="card-block">
                <div class="pl-2 pr-2 pt-2">
                    <h4 class="text-bold-500">{{'topnavbar.Notifications' | translate }}</h4>
                </div>
                <div class="pl-2 pr-2 pb-2" style="line-height: 1.2em;">
                    <div class="row font-small-3 mb-1">
                        <div class="col-1 pr-0">
                            <em class="fas fa-info-circle"></em>
                        </div>
                        <div class="col-7 pl-2 pr-0">
                            <p class="">{{'generics.Status' | translate }}</p>
                        </div>
                        <div class="col-4">
                            <span *ngIf="basicInfoPatient.status == null || basicInfoPatient.status == 'new'" class="badge badge-secondary" style="white-space: inherit !important;">{{'war.status.opt1' | translate }}</span>
                            <span *ngIf="basicInfoPatient.status == 'contacted'" class="badge badge-secondary">{{'war.status.opt2' | translate }}</span>
                            <span *ngIf="basicInfoPatient.status == 'pending'" class="badge badge-secondary">{{'war.status.opt3' | translate }}</span>
                            <span *ngIf="basicInfoPatient.status == 'ontheway'" class="badge badge-secondary">{{'war.status.opt4' | translate }}</span>
                            <span *ngIf="basicInfoPatient.status == 'contactlost'" class="badge badge-secondary">{{'war.status.opt5' | translate }}</span>
                            <span *ngIf="basicInfoPatient.status == 'helped'" class="badge badge-secondary">{{'war.status.opt6' | translate }}</span>
                        </div>
                    </div>
                    <!--One notification-->
                    <div class="row font-small-3 mb-1">
                        <div class="col-1 pr-0">
                            <em class="fas fa-info-circle"></em>
                        </div>
                        <div class="col-7 pl-2 pr-0">
                            <p class="">{{'war.titleNoti1' | translate }}</p>
                        </div>
                        <div class="col-4">
                            <a class="btn btn-white btn-sm w-100" style="word-wrap: normal;" routerLink="/pages/support">
                                <span class="">
                                    {{'support.support' | translate }}
                                </span>
                              </a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="card">
            <div class="card-block p-2">
                <h2 class="content-header mt-0 mb-2">{{'generics.Basic Data' |
                    translate }}</h2>
                <form (ngSubmit)="onSubmit()" #f="ngForm">
                    <p class="text-left">
                        <ui-switch id="enabled" (change)="changedCaretaker($event)" name="caretaker" [(ngModel)]="userInfo.iscaregiver"></ui-switch> 
                        <span class="ml-1">{{'war.titletoogle' | translate }}</span>
                    </p>
                    <div class="form-group">
                        <div class="">
                            <label>{{'menu.Basic Info' | translate }}</label>
                            <input class="form-control d-none" id="birthDate_" name="birthDate" matInput
                                placeholder="{{'personalinfo.Birth Date' | translate }}" readonly
                                [matDatepicker]="pickerOnset" (click)="pickerOnset.open()"
                                [(ngModel)]="basicInfoPatient.birthDate">
                            <input readonly class="form-control d-inline" (click)="pickerOnset.open()"
                                style="background-color: #fff !important;"
                                [placeholder]="(basicInfoPatient.birthDate!=null) ? (basicInfoPatient.birthDate | date: 'dd MMM y': '' : translate.currentLang) : getLiteral('personalinfo.Birth Date')">
    
                            <mat-datepicker-toggle matSuffix [for]="pickerOnset" class="d-none">
                            </mat-datepicker-toggle>
                            <mat-datepicker startView="multi-year"
                                (daySelected)="closeDatePickerStart($event, pickerOnset)" touchUi="true"
                                #pickerOnset></mat-datepicker>
                            <!--<p *ngIf="datainfo.birthDate ==null || datainfo.birthDate ==''" class="danger">{{'generics.required' | translate }}</p>-->
                        </div>
                    </div>
                    <div class="form-group">
                        <div class="">
                            <select id="group" name="group" class="form-control" ngModel #group="ngModel"
                                [(ngModel)]="basicInfoPatient.group" [required]="true">
                                <option [value]="null" disabled selected>--{{'registration.Please select a
                                    group' | translate }}--</option>
                                <option *ngFor="let group of groups" [ngValue]="group._id">
                                    <span
                                        *ngIf="group.name != 'Undiagnosed'  && group.name != 'None'">{{group.name}}</span>
                                    <span *ngIf="group.name == 'Undiagnosed'">{{'personalinfo.I dont have a
                                        diagnosis' | translate }}</span>
                                    <span *ngIf="group.name == 'None'">{{'personalinfo.I dont belong to a
                                        patient group' | translate }}</span>
                                </option>
                            </select>
                            <small class="form-text text-muted danger"
                                *ngIf="!group.valid && (group.dirty || group.touched)">{{'generics.required'
                                | translate }}</small>
                        </div>
                    </div>
                    <div class="row p-2">
                        <p class="mb-0"><strong>{{'war.Indicates the approximate location' | translate }}</strong></p>
                        <agm-map [latitude]="lat" [longitude]="lng" [zoom]="zoom"  (mapClick)="changePickupMarkerLocation($event)">
                            <agm-marker [latitude]="basicInfoPatient.lat" [longitude]="basicInfoPatient.lng" [title]="'Pickup Location'"></agm-marker>
                        </agm-map>
                    </div>
                </form>
            </div>
            <div class="card-block p-2 mt-2">
                <h2 class="content-header mt-0">{{'war.needsTitle' | translate }}</h2>
                <p>{{'war.needsSubtitle' | translate }}</p>
                <textarea maxlength="150" name="needs"  [(ngModel)]="basicInfoPatient.needs"
                            placeholder="{{'seizures.Write down any details' | translate }}"
                            class="autoajustable form-control"></textarea>
                            <div class="text-left form-group">
                                <mat-checkbox class="example-margin" style="position: absolute; margin-top: 2px;" name="terms2"
                                 id="terms2" [(ngModel)]="basicInfoPatient.needShelter">
                                </mat-checkbox> 
                                <span class="ml-3">
                                    {{'war.Need shelter' | translate }}
                                  </span>
                            </div>
                            <div *ngIf="!callingTextAnalytics && basicInfoPatient.drugs.length>0">
                                <table class="table text-center">
                                    <thead>
                                        <tr>
                                            <th>{{'medication.Drug' | translate }}</th>
                                            <th>{{'medication.Dose' | translate }}</th>
                                            <th>{{'war.Links' | translate }}</th>
                                            <th></th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr
                                            *ngFor="let drug of basicInfoPatient.drugs ; let i = index">
                                            <td>{{drug.name}}</td>
                                            <td>{{drug.dose}}</td>
                                            <td>
                                                <span *ngIf="drug.link!=''">
                                                    <a class="info" data-original-title="" title=""
                                                    href="https://www.whocc.no/atc_ddd_index/?code={{drug.link}}" target="_blank">
                                                    www.whocc.no
                                                    </a>
                                                    <a class="info d-block" data-original-title="" title=""
                                                    href="https://www.rxreasoner.com/atccodes/{{drug.link}}" target="_blank">
                                                    www.rxreasoner.com
                                                    </a>
                                                </span>
                                                <span *ngIf="drug.link==''">
                                                    -
                                                </span>
                                                
                                            </td>
                                            <td><a class="btn btn-outline-danger mb-0" (click)="confirmDeleteDrug(i);" href="javascript:void(0)"><i class="fa fa-times"></i></a></td>
                                        </tr>
                                    </tbody>
                                </table>
                                
                            </div>
                <div class="center-elements mt-2">
                    <button *ngIf="!saving" class="mt-2 btn btn-dark" (click)="setNeeds();">{{'generics.Save changes' | translate
                        }}</button>
                        <button *ngIf="saving" class="mt-2 btn btn-dark" [disabled]="saving" (click)="setNeeds();">{{'generics.Please wait' | translate
                        }} <i class="fa fa-spinner fa-spin fa-fw"></i></button>
                </div>
            </div>
        </div>

    </div>


    
    <div class="mx-auto" style="max-width: 30rem !important;">
        <div>
            
        </div>
    </div>

</div>